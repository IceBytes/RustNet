import os
import sys
import subprocess

style = '''
    body {
        font-family: Arial, sans-serif;
        background-color: #121212;
        color: #ffffff;
        margin: 20px;
    }

    h1 {
        color: #00ff00;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    th, td {
        border: 1px solid #00ff00;
        padding: 10px;
        text-align: left;
    }

    th {
        background-color: #00ff00;
        color: #121212;
    }

    tr:nth-child(even) {
        background-color: #333;
    }

    a {
        color: #00ff00;
        text-decoration: none;
    }

    a:hover {
        text-decoration: underline;
    }
'''

def write_html(word_search, table_rows):
    html_template = f'''
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>RustNet - Exploit finder</title>
        <style>
            {style}
        </style>
    </head>
    <body>
        <h1>Exploit Finder Results for: {word_search}</h1>
        <table border="1">
            <tr>
                <th>Date</th>
                <th>Exploit</th>
                <th>Link</th>
            </tr>
            {table_rows}
        </table>
    </body>
    </html>
    '''

    with open("out.html", "w") as html_file:
        html_file.write(html_template)

def __helper_write_html(iterable_data):
    data_result = {}
    table_rows = ""

    for word_search, list_results in iterable_data.items():
        table_rows += f"""
        <br>
        <h3 style="color:lime;"> Results for search:  {word_search}</h3>
        <br>
        <table style="color:lime; border:1">
            <thead>
                <tr>
                    <td></td>
                    <th>Date</th>
                    <th>Description</th>
                    <th>Url</th>
                </tr>
                <tr><td colspan="4" style="border: none; height: 10px;"></td></tr>
            </thead>
            <tbody>
        """
        for dict_result in list_results:
            for key, result in dict_result.items():
                for exploit_data in result:
                    table_rows += f"""
                        <tr>
                            <td></td>
                            <td>{exploit_data["date"]}</td>
                            <td>{exploit_data["name"]}</td>
                            <td><a style="color:lime;" id="url_download" href="{exploit_data["url"]}" target='_blank'>{exploit_data["url"]}</a></td>
                        </tr>
                        <tr><td colspan="4"><hr></td></tr>
                    """
    table_rows += """
                </tbody>
            </table>
    """
    data_result["word_search"] = word_search
    data_result["table_rows"] = table_rows
    return data_result

def open_url(url):
    if sys.platform == 'win32':
        os.startfile(url)
    elif sys.platform == 'darwin':
        subprocess.Popen(['open', url])
    else:
        try:
            subprocess.Popen(['xdg-open', url])
        except OSError:
            print('Please open a browser on: ' + url)

def write_txt(dict_all_results):
    with open("out.txt", "w", encoding="utf-8") as f:
        f.write("date | description | url\n")
        for word_search, list_results in dict_all_results.items():
            for dict_result in list_results:
                for key, result in dict_result.items():
                    for exploit_data in result:
                        f.write("{0} | {1} | {2}\n".format(
                            exploit_data["date"],
                            str(exploit_data["name"]),
                            exploit_data["url"])
                        )
                        f.write("\n")
